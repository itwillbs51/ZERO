(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{1767:function(t,e,n){"use strict";n.d(e,"a",(function(){return v})),n.d(e,"b",(function(){return w}));var o=n(4),r=n(7),l=(n(36),n(152)),c=n(377),d=n(70),h=n(34),f=n(198);function v(){window.AppleID.auth.init({scope:"email",clientId:"kr.co.kream",redirectURI:"https://kream.co.kr"})}function m(){Object(f.a)(c.a.LOGIN,Object(r.a)({},c.b.SIGN_METHOD,"apple"))}function w(t,e,n){return $.apply(this,arguments)}function $(){return($=Object(o.a)(regeneratorRuntime.mark((function t(e,n,code){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.app.$axios.post("/api/social/apple/login",{identity_token:n,code:code}).then((function(t){var o=t.data,r=o.email,l=o.user,c=o.login_success,d=o.social_auth_provider,h=o.social_auth_uid,f=o.access_token,v=o.refresh_token;if(e.$storage.setState("logged_email",r),e.$storage.setState("social_auth_uid",h),e.$storage.setState("social_auth_provider",d||"apple"),e.$storage.setUniversal("login_type","social"),c)if(null===l.phone)e.$storage.setState("invalidUser",!0);else{var w="local";e.setUser(l),e.setToken(w,f),e.setRefreshToken(w,v),e.$storage.setState("token",f),e.$storage.setUniversal("strategy",w),e.ctx.app.$config.isDevelopPhase||m()}else e.$storage.setState("token",n),e.$storage.setState("logged_status","join")})).catch((function(t){throw Object(d.d)({content:l.b[t.response.data.code]||l.f,type:h.ToastType.error}),t}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},2231:function(t,e,n){},2889:function(t,e,n){"use strict";n(2231)},3356:function(t,e,n){"use strict";n.r(e);var o=n(4),r=n(38);n(36),n(40),n(8),n(26),n(14),n(27),n(28),n(25),n(74),n(252);var l=n(370),c=n(60),d=n(7),h=n(152),f=n(377),v=n(51),m=n(6),w=n(70),$=n(34),_=n(198),k=n(200);function y(t,e,n){var o,r,l;e.$storage.setState("logged_email",t),e.$storage.setUniversal("login_type","email");var c=n.data.access_token,h=n.data.refresh_token;e.setToken("local",c),e.$storage.setState("token",c),e.setRefreshToken("local",h),e.setUser(n.data.user),Object(k.b)(null===(o=n.data)||void 0===o||null===(r=o.user)||void 0===r||null===(l=r.extra)||void 0===l?void 0:l.cuid),Object(_.a)(f.a.LOGIN,Object(d.a)({},f.b.SIGN_METHOD,"email"))}function I(t,e,n){return C.apply(this,arguments)}function C(){return(C=Object(o.a)(regeneratorRuntime.mark((function t(e,n,o){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.a.post("/api/auth/login",{email:e,password:n}).catch((function(t){var e=t.response.data,code=e.code,n=e.message;Object(w.d)({content:code===v.b.SERVER_ERROR?n:h.b[code]||h.f,type:$.ToastType.error})}));case 2:return r=t.sent,t.abrupt("return",new Promise((function(t){void 0===r||200!==r.status&&201!==r.status||(null!=r.data.user.phone&&y(e,o,r),t(r))})));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var O=n(1767),j=n(186),S=n(15),E=n(168),x=n(240),L=n(451),U={name:"LoginIndex",components:{},beforeRouteEnter:function(t,e,n){n((function(n){var o,r=null===(o=null==t?void 0:t.query)||void 0===o?void 0:o.returnUrl,l=null==n?void 0:n.$getCertainLoginReferrer(document,null==e?void 0:e.fullPath);n.referrer=l,n.returnUrl=r||l}))},layout:function(t){return Object(x.b)(t.app.$ua)?"bridge":"search"},middleware:function(t){var e=t.$ua,n=t.store,o=t.redirect,r=t.res;if(r&&r.setHeader("Cache-Control","no-store"),!Object(x.b)(e))return Object(l.loggedIn)(n)?o("/"):void 0},data:function(){return{referrer:"/",returnUrl:"/",eyeOn:!1,eyeIcon:"ico-eye-off",inputType:"password",email:null,password:null,showErrorEmail:!1,showErrorPassword:!1,unwatch:[],alreadyLoggedIn:!1}},head:function(){return{script:[{src:"https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js"}],meta:[{name:"robots",content:"noindex"}].concat(Object(r.a)(this.$getOpenGraph({"page-name":S.n.sign_in})),Object(r.a)(Object(L.b)()))}},computed:{isInAppBrowser:function(){return Object(x.b)(this.$ua)},lookData:function(){return[{text:"이메일 가입",link:this.getJoinLink()},{text:"이메일 찾기",link:"/login/find_email"},{text:"비밀번호 찾기",link:"/login/find_password"}]},validateForm:function(){return this.validEmail&&this.validPassword},validEmail:function(){return Object(c.e)(this.email)},validPassword:function(){return Object(c.f)(this.password)}},beforeDestroy:function(){this.unwatch.forEach((function(t){return t()}))},created:function(){if(this.$isInAppBrowser(this.$ua)&&this.$loggedIn(this.$auth))return console.log("[KreamWebView] set already logged in flag"),void(this.alreadyLoggedIn=!0);this.reset()},mounted:function(){var t,e,n,o,r,l,c,d,h,f,v,m=this;if(this.$isInAppBrowser(this.$ua)){var w=Object(E.a)(this.returnUrl);if(console.log("[KreamWebView] mounted: ",w),console.log("[KreamWebView] alreadyLoggedIn: ",this.alreadyLoggedIn),this.alreadyLoggedIn||this.$loggedIn(this.$auth))return console.log("[KreamWebView] already logged in. return to: ",this.returnUrl),v=this.returnUrl,void(window.history.replaceState?(window.history.replaceState(null,document.title,v),window.history.go(0)):window.location.replace(v));!function(t){var e,n,o,r;try{(null===(e=window.KreamWebView)||void 0===e?void 0:e.postMessage)&&window.KreamWebView.postMessage(JSON.stringify(t)),(null===(r=null===(o=null===(n=window.webkit)||void 0===n?void 0:n.messageHandlers)||void 0===o?void 0:o.kreamWebViewHandler)||void 0===r?void 0:r.postMessage)&&window.webkit.messageHandlers.kreamWebViewHandler.postMessage(t),console.log("[KreamWebView] SUCCESS postMessage",t)}catch(t){console.log("[KreamWebView] FAIL postMessage",t)}}({type:"login_required",payload:{redirectUrl:w}}),Object(x.c)(this.$ua,"4.8.0")||(console.log("[KreamWebView] version <4.8.0"),this.$toast({content:this.$t(this.$m.$common.requiredUpdateAppVersion),type:$.ToastType.error,timeout:1e4}))}if((null===(e=null===(t=this.$auth)||void 0===t?void 0:t.state)||void 0===e?void 0:e.loggedIn)||"local"!==(null===(o=null===(n=this.$auth)||void 0===n?void 0:n.state)||void 0===o?void 0:o.strategy)||(null===(l=null===(r=this.$auth)||void 0===r?void 0:r.state)||void 0===l?void 0:l.social_auth_provider)||this.$trackAmplitude(S.m.view_page_sign_in,new S.i(S.n.sign_in)),null===(d=null===(c=this.$auth)||void 0===c?void 0:c.$storage)||void 0===d?void 0:d.getState("invalidUser")){var _=this.$auth.$storage.getState("token");this.startIdentification(_,(function(){m.$auth.loginWith("social_naver")}))}"join"===(null===(f=null===(h=this.$auth)||void 0===h?void 0:h.$storage)||void 0===f?void 0:f.getState("logged_status"))&&this.$router.push(this.getJoinLink()),this.watchLoginState("invalidUser",!0,(function(){setTimeout((function(){var t=m.$auth.$storage.getState("token");m.$auth.$storage.setState("invalidUser",!1),m.startIdentification(t,(function(){m.$auth.loginWith("social_naver")}))}),700)})),this.watchLoginState("logged_status","join",(function(){m.$router.push(m.getJoinLink())})),this.watchLoginState("loggedIn",!0,(function(){if(!m.$lodash.isEmpty(m.$auth.user)){if(m.$auth&&m.$auth.user&&m.$auth.user.password_change_required)return m.$auth.$storage.setLocalStorage("lastPath",m.returnUrl),void(window.location.href="/login/change_password");var t=Object(S.r)(m.$auth.$storage.getState("login_type"),m.$auth.$storage.getState("social_auth_provider"));t!==S.p.apple&&m.$trackAmplitude(S.m.complete_sign_in,new S.i(S.n.sign_in,t)),window.location.replace(m.returnUrl)}}))},methods:{watchLoginState:function(t,e,n){this.unwatch.push(this.$auth.$storage.watchState(t,(function(t){t===e&&n()})))},reset:function(){this.$auth.reset()},onClickApple:function(){Object(O.a)(),window.AppleID.auth.signIn()},onClickNaver:function(){this.$loggedIn(this.$auth)||(this.$isMobile(this.$mq)?(this.$auth.$storage.setLocalStorage("lastPath",this.returnUrl),this.$router.replace("/login/naver")):this.$popupLoginNaver())},enterPassword:function(){this.validateForm&&this.onClickLogin()},check:function(t,e,n){var o=this;this.$auth.$storage.setState("invalidUser",!1),this.$lodash.isEmpty(t.data.check_url)||Object(j.j)(t.data.check_url).then((function(t){o.$checkIdentification(t,o.$router,o.$auth,(function(){o.$axios.create({headers:{Authorization:"Bearer ".concat(e)}}).post("/api/auth/identification/confirm",{id_key:t.data.id_key}).then((function(){n()}))}))}))},onClickLogin:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.reset(),e.next=3,I(t.email,t.password,t.$auth);case 3:null==(n=e.sent).data.user.phone&&(o=n.data.access_token,t.startIdentification(o,(function(){I(t.email,t.password,t.$auth)})));case 5:case"end":return e.stop()}}),e)})))()},startIdentification:function(t,e){var n=this;Object(w.a)({content:h.c.EXISTS_IDENTIFICATION_NOTICE,handleConfirm:function(){null==n.$createPopup("/join/identification","popupIdentification")&&Object(w.d)({content:"팝업이 차단되었는지 확인해주세요.",type:$.ToastType.error}),n.$nuxt.$on("startIdentification",(function(o,r){var l=setInterval((function(){o.closed&&(clearInterval(l),n.check(r,t,e),n.$nuxt.$off("startIdentification"))}),100)}))},handleCancel:function(){n.$auth.reset()},cancelButtonEnabled:!0})},getJoinLink:function(){return this.$route.query.code?"/join?code=".concat(this.$route.query.code):"/join"}}},T=(n(2889),n(3)),component=Object(T.a)(U,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container login"},[t.isInAppBrowser?t._e():n("div",{class:["content",t.$mq]},[n("div",{staticClass:"login_area"},[t._m(0),n("InputBox",{staticClass:"has_button",attrs:{"input-type":"email",placeholder:"예) kream@kream.co.kr","has-error":t.showErrorEmail},on:{input:function(e){t.showErrorEmail=!t.validEmail}},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}},[n("h3",{staticClass:"input_title",attrs:{slot:"title"},slot:"title"},[t._v("이메일 주소")]),n("p",{staticClass:"input_error",attrs:{slot:"error"},slot:"error"},[t._v("이메일 주소를 정확히 입력해주세요.")]),n("BaseButton",{directives:[{name:"show",rawName:"v-show",value:!t.$lodash.isEmpty(t.email),expression:"!$lodash.isEmpty(email)"}],staticClass:"input_delete",attrs:{slot:"button"},on:{onClick:function(e){t.email=""}},slot:"button"},[n("svg-icon",{staticClass:"ico-delete-circle",attrs:{name:"ico-delete-circle"}})],1)],1),n("InputBox",{class:["has_button",{eye_on:t.eyeOn}],attrs:{"input-type":t.inputType,placeholder:"","has-error":t.showErrorPassword},on:{input:function(e){t.showErrorPassword=!t.validPassword},enter:t.enterPassword},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}},[n("h3",{staticClass:"input_title",attrs:{slot:"title"},slot:"title"},[t._v("비밀번호")]),n("p",{staticClass:"input_error",attrs:{slot:"error"},slot:"error"},[t._v(" 영문, 숫자, 특수문자를 조합해서 입력해주세요. (8-16자) ")])]),n("div",{staticClass:"login_btn_box"},[n("BaseButton",{attrs:{tag:"a",href:"#","style-type":"full solid",disabled:!t.validateForm},on:{onClick:t.onClickLogin}},[t._v(" 로그인 ")])],1),n("ul",{staticClass:"look_box"},t._l(t.lookData,(function(e,o){return n("li",{key:o,staticClass:"look_list"},[n("nuxt-link",{staticClass:"look_link",attrs:{to:e.link}},[t._v(" "+t._s(e.text)+" ")])],1)})),0),n("div",{staticClass:"social_login"},[n("BaseButton",{staticClass:"btn_login_naver",attrs:{type:"button","style-type":"full outline"},on:{onClick:t.onClickNaver}},[n("svg-icon",{staticClass:"logo-social",attrs:{name:"logo-naver"}}),t._v(" 네이버로 로그인 ")],1),n("BaseButton",{staticClass:"btn_login_apple",attrs:{type:"button","style-type":"full outline"},on:{onClick:t.onClickApple}},[n("svg-icon",{staticClass:"logo-social",attrs:{name:"logo-apple"}}),t._v(" Apple로 로그인 ")],1)],1)],1)])])}),[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("h2",{staticClass:"login_title"},[n("span",{staticClass:"blind"},[t._v("KREAM")])])}],!1,null,"2b15bea4",null);e.default=component.exports;installComponents(component,{BaseButton:n(158).default,InputBox:n(758).default})}}]);