<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.zero.mapper.ZmanDeliveryMapper">

	<!-- 배달 예정 목록 조회 - SELECT -->
	<!-- 중고물품 오더 테이블과 JOIN 필요 -->
	<select id="selectDeliveryYetList" resultType="com.itwillbs.zero.vo.ZmanDeliveryVO">
		SELECT
			zd.*, os.order_secondhand_product
		FROM
			ZMAN_DELIVERY zd 
		JOIN
			ORDER_SECONDHAND os
			ON 
				zd.order_secondhand_idx = os.order_secondhand_idx
		WHERE zman_delivery_status = "배달 예정"
	</select>
	
	<!-- ZMAN 배달 출발지 리스트 가져오기 -SELECT -->
	<select id="selectDeliveryStartspotList" resultType="com.itwillbs.zero.vo.ZmanDeliveryVO">
		SELECT
			zman_delivery_startspot
			FROM
				ZMAN_DELIVERY
	</select>
	
	<!-- 마커 클릭 시 보여줄 정보 가져오기 -->
	<select id="selectMarkerClickInfo" resultType="com.itwillbs.zero.vo.ZmanDeliveryVO">
		SELECT
			*
			FROM
				ZMAN_DELIVERY
	</select>
	
	<!-- DB 에 저장된 출발지와 도착지 가져오기 - 파라미터 zman_delivery_idx -->
	<select id="selectDeliveryLocation" resultType="com.itwillbs.zero.vo.ZmanDeliveryVO">
		SELECT *
			FROM ZMAN_DELIVERY
			WHERE zman_delivery_idx = 15;
	</select>
	
	<!-- ZMAN 중고물품 오더 배달 수락하기 - UPDATE -->
	<update id="updateDelivery">
		UPDATE 
			ZMAN_DELIVERY 
			SET 
				zman_delivery_accepttime = now()
				, zman_delivery_status = '배달 수락'
				, zman_id = #{zman_id}
			WHERE
				zman_delivery_idx = #{zman_delivery_idx};
	</update>
	
	<!-- 배달 상세 정보 - 출발지와 배달지 가져오기 - SELECT -->
	<select id="selectDeliveryDetail" resultType="com.itwillbs.zero.vo.ZmanDeliveryVO">
		SELECT *
			FROM
				ZMAN_DELIVERY
			WHERE
				zman_delivery_idx = #{zman_delivery_idx};
	</select>
	
<<<<<<< HEAD
	<!-- ZMAN zman_delivery_status "배달 시작" 로 변경하기 -->
	<update id="updateDeliveryDetail">
		UPDATE 
			ZMAN_DELIVERY 
			SET 
				zman_delivery_starttime = now()
				, zman_delivery_status = '배달 시작'
			WHERE
				zman_delivery_idx = #{zman_delivery_idx};
	</update>
	
	<!-- ZMAN zman_delivery_status "배달 완료" 로 변경하기 -->
	<update id="updateDeliveryEnd">
		UPDATE 
			ZMAN_DELIVERY 
			SET 
				zman_delivery_endtime = now()
				, zman_delivery_status = '배달 완료'
			WHERE
				zman_delivery_idx = #{zman_delivery_idx};
	</update>
	
	<!--  -->
	<insert id="insertDeliveryDone">
	    INSERT INTO ZMAN_EARNING (
	        zman_earning_idx
	        , zman_delivery_commission
	        , zman_delivery_idx
	        , zman_id
	    )
	    VALUES (
		        null
		        , #{zman_delivery_commission}
		        , #{zman_delivery_idx}
		        , #{zman_id}
		    )
	</insert>
	
	<!-- ZMAN 배달 완료 내역 페이지로 이동 -->
	<select id="selectDeliveryDoneList" resultType="com.itwillbs.zero.vo.ZmanDeliveryVO">
		SELECT
			zd.*, os.order_secondhand_product
		FROM
			ZMAN_DELIVERY zd 
		JOIN
			ORDER_SECONDHAND os
			ON 
				zd.order_secondhand_idx = os.order_secondhand_idx
		WHERE zman_delivery_status = "배달 완료"
	</select>

=======
	<!-- updateDeliveryDetailStart -->
<!-- 	<update id="updateDeliveryDetailStart"> -->
<!-- 		UPDATE -->
<!-- 			ZMAN_DELIVERY -->
<!-- 			SET -->
<!-- 				zman_delivery_status = '배달 중' -->
<!-- 				, zman_delivery_starttime = now() -->
<!-- 			WHERE -->
<!-- 				zman_delivery_idx = #{zman_delivery_idx}; -->
<!-- 	</update> -->

	
>>>>>>> branch 'main' of https://github.com/itwillbs51/ZERO.git
</mapper>
