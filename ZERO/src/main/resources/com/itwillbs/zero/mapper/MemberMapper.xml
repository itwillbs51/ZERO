<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.zero.mapper.MemberMapper">
	<!-- 설정상 먼저 만들어둠! 파이팅! - 지영 -->
	
	<!-- 회원가입 - 정의효 -->
	<insert id="insertMember" parameterType="Member">
		INSERT
			INTO
				MEMBER
			VALUES (
				#{member_id}
				, #{member_idx}
				, #{member_nickname}
				, #{member_passwd}
				, #{member_name}
				, #{member_birth}
				, now()                -- {member_date}
				, #{member_phone}
				, '활동'                -- {member_status}
				, #{member_agreement_marketing}  -- {member_agreement_marketing}
				, '회원'                -- {member_type}
				, 'Y'                   -- {member_mail_auth}
				, #{member_image} 
				, #{member_address1}
				, #{member_address_detail1}
				, #{member_address2}
				, #{member_address_detail2}
				, #{member_address3}
				, #{member_address_detail3}
				, #{member_withdrawal}
				, #{member_bank_name}
				, 'N'
				, #{member_zipcode1}
				, #{member_zipcode2}
				, #{member_zipcode3}
				, #{member_intro}
				, #{member_address2_phone}
				, #{member_address3_phone}
			)
	
	</insert>
	
	<!-- 아이디 중복 확인 - 정의효 -->
	<select id="idCheck" parameterType="String" resultType="int">
		SELECT COUNT(member_id) FROM MEMBER WHERE member_id = #{member_id}
	</select>
	
	<!-- 닉네임 중복 확인 - 정의효 -->
	<select id="nickCheck" parameterType="String" resultType="int">
		SELECT COUNT(member_nickname) FROM MEMBER WHERE member_nickname = #{member_nickname}
	</select>
	
	<!-- 핸드폰 중복 확인 - 정의효 -->
	<select id="phoneCheck" parameterType="String" resultType="int">
		SELECT COUNT(member_phone) FROM MEMBER WHERE member_phone = #{member_phone}
	</select>
	
	<!-- 마이페이지 - 메인 구매내역 조회 - 정의효 -->
	<select id="selectMyOdShList" resultType="Orsh">
		SELECT
			order_secondhand_seller
			, order_secondhand_buyer
			, order_secondhand_date
			, order_secondhand_product
			, order_secondhand_type
			, order_secondhand_status
		FROM
			ORDER_SECONDHAND
		JOIN
			SECONDHAND
		ON
			SECONDHAND.secondhand_idx = ORDER_SECONDHAND.secondhand_idx
		WHERE 
			order_secondhand_buyer = #{member_id}
		ORDER BY
			order_secondhand_date DESC
		LIMIT
			#{startRow}
			, #{listLimit}			
	</select>
	
	
	<!-- 특정 컬럼으로 회원정보 조회 -수정 -->
	<select id="selectMemberCheck" resultType="map">
		SELECT *
			FROM MEMBER
				WHERE ${column} = #{value}
	</select>
	
	<!-- 세션 아이디가 동일한 회원 회원정보 변경 -수정 -->
	<update id="updateMemberImage">
		UPDATE MEMBER
			SET ${column2} = #{value2}
				WHERE ${column1} = #{member_id}
	</update>
	
	
		
	
	<!-- 회원정보 조회(혜진) -->
	<select id="selectMember" resultType="com.itwillbs.zero.vo.MemberVO">
		SELECT * FROM MEMBER
		WHERE member_id = #{member_id}
	</select>
	
	<!-- 계좌인증 완료한 회원의 member_bank_auth를 'Y'로 수정(혜진) -->
	<update id="updateBankAuth">
		UPDATE MEMBER
		SET member_bank_auth = 'Y'
		WHERE member_id = #{member_id}
	</update>
	
	<!-- 회원 아이디로 계좌정보 조회 -->
	<select id="selectMemberJoin">
		SELECT * 
			FROM MEMBER m
				JOIN ZPAY z
					ON m.member_id = z.member_id
					WHERE m.member_id = #{member_id}
	</select>
	
	<!-- 회원 아이디로 중고 판매 정보 조회 - 수정 -->
	<select id = "selectSecondhandList" resultType="map">
		SELECT * 
			FROM MEMBER m
				LEFT OUTER JOIN SECONDHAND s
				ON s.member_id = m.member_id
				WHERE s.member_id = #{member_id}
	</select>
	
	<!-- 찜 목록리스트 조회 - 수정 -->
	<select id = "selectLikeList" resultType="map">
		SELECT * FROM LIKES l 
			JOIN `MEMBER` m 
				ON l.member_id = m.member_id
			JOIN SECONDHAND s 
				ON l.secondhand_idx = s.secondhand_idx
					WHERE member_id = #{member_id}
	</select>
	
</mapper>
