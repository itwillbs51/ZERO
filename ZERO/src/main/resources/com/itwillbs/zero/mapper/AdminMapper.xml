<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.zero.mapper.AdminMapper">
	<!-- 회원 목록 조회 -->
	<select id="selectMemberList" resultType="com.itwillbs.zero.vo.MemberVO">
		SELECT * FROM MEMBER
	</select>
	
	<!-- 회원 정보 조회 -->
	<select id="selectMember" resultType="com.itwillbs.zero.vo.MemberVO">
		SELECT * FROM MEMBER
		WHERE member_idx = #{member_idx}
	</select>
	
	<!-- 회원관리 - 회원 피신고 건수 조회 -->
	<select id="selectMemberReportCount">
		SELECT COUNT(*) 
			FROM REPORT
			WHERE reported_member_id = #{member_id}
	</select>
	
	
	<!-- 회원관리 - 회원 정보 삭제 -->
	<delete id="deleteMemebr">
		DELETE FROM MEMBER
		WHERE member_idx = #{member_idx}
	</delete>
	
	<!-- 회원관리 - 회원 정보 수정 -->
	<update id="updateMember">
		UPDATE MEMBER
			SET
				member_status = #{member_status}
				, member_phone = #{member_phone}
			WHERE member_idx = #{member_idx}
	</update>
	
	<!-- 회원관리 - 회원 신고 목록 조회 -->
	<select id="selectMemberReportList" resultType="com.itwillbs.zero.vo.ReportVO">
		SELECT * FROM REPORT
			WHERE 
				report_type = '회원'
			<if test="!reported_member_id.equals('')">
				AND
					reported_member_id = #{reported_member_id}
			</if>
	</select>
	
	<!-- 회원관리 - 회원 신고 정보 조회 -->
	<select id="selectMemberReportDetail" resultType="com.itwillbs.zero.vo.ReportVO">
		SELECT * FROM REPORT
		WHERE report_idx = #{report_idx}
	</select>
	
	<!-- 회원관리 - 회원 신고 정보 수정(처리상태 변경) -->
	<update id="updateMemberReport">
		UPDATE REPORT
			SET 
				report_status = #{report_status}
			WHERE 
				report_idx = #{report_idx}
	</update>
	
	<!-- 고객센터관리 - 공지사항 목록 조회 -->
	<select id="selectCsList"  resultType="map">
		SELECT * 
			FROM CS c 
			JOIN MEMBER m ON m.member_id = c.member_id
			WHERE cs_type = '공지'
			ORDER BY cs_date DESC
	</select>
	
	<!-- 고객센터관리 - 공지사항 '관리자'인지 확인 -->
	<select id="selectAdminMember" resultType="string">
		SELECT member_type FROM MEMBER
		WHERE member_id = #{member_id}
	</select>	
	
	<!-- 고객센터관리 - 공지사항 글쓰기 -->
	<insert id="insertNotice" parameterType="com.itwillbs.zero.vo.CsVO">
		INSERT INTO 
			CS(
				cs_idx
				, cs_subject
				, cs_content
				, cs_date
				, member_id
				, cs_type
				, cs_file
			)
			VALUES(
				null
				, #{cs_subject}
				, #{cs_content}
				, now()
				, #{member_id}
				, #{cs_type}
				, #{cs_file}
			)
	</insert>
	
	<!-- 고객센터관리 - 공지사항 글 정보 조회 -->
	<select id="selectCs" resultType="com.itwillbs.zero.vo.CsVO">
		SELECT * 
			FROM CS c 
			JOIN MEMBER m ON m.member_id = c.member_id
			WHERE cs_idx = #{cs_idx}
	</select>
	
	<!-- 고객센터관리 - 공지사항 글수정 -->
	<update id="updateNotice">
		UPDATE CS
		SET
			cs_subject = #{cs_subject}
			, cs_content = #{cs_content}
			, cs_date = now()
			, member_id = #{member_id}
			, cs_file = #{cs_file}
		WHERE cs_idx = #{cs_idx}
	</update>
	
	<!-- 고객센터관리 - 공지사항 글삭제 -->
	<delete id="deleteNotice">
		DELETE FROM CS
		WHERE cs_idx = #{cs_idx}
	</delete>
	
	<!-- 고객센터관리 - 1:1 문의 글 조회 - SELECT -->
	<select id="selectCsQnAList" resultType="com.itwillbs.zero.vo.CsVO">
		SELECT *
			FROM CS
			WHERE cs_type = "1:1문의"
	</select>
</mapper>
