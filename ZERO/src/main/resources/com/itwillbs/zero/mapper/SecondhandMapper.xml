<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.zero.mapper.SecondhandMapper">

	<!-- 중고 카테고리 조회 작업 -->
	<select id="selectCategoryList" resultType="hashmap">
		SELECT * 
		FROM 
			CATEGORY
		WHERE 
			category_type = '중고'
	</select>
	
		<!-- 상품번호에 해당하는 카테고리 정보 조회작업 --> 
<!-- 	<select id="selectCategory" resultType="String"> -->
<!-- 		SELECT  -->
<!-- 			c.category_name -->
<!-- 		FROM -->
<!-- 			CATEGORY c -->
<!-- 		JOIN -->
<!-- 			SECONDHAND s -->
<!-- 		ON  -->
<!-- 			c.category_idx = s.category_idx -->
<!-- 		WHERE  -->
<!-- 			s.secondhand_idx = #{secondhand_idx} -->
<!-- 	</select> -->
	
	
	<!-- 중고 상품 등록 작업  -->
	<insert id="insertProduct">

		INSERT INTO 
			SECONDHAND	
		VALUES (
			null 								-- secondhand_idx		 	
			, #{secondhand_price}
			, #{secondhand_subject}
			, #{secondhand_content}
			, #{secondhand_deliveryType_ptp}
			, #{secondhand_paymentType_ptp}
			, #{secondhand_image1}
			, #{secondhand_image2}
			, #{secondhand_image3}
			, now()								-- 작성일
			, null 								-- update date
			, 0									-- read count(조회수)
			, secondhand_idx + 1				-- re_ref
			, '판매중'							-- deal_status(default 거래중?)
			, #{member_id}	 					-- 작성자
			, #{category_idx}
			, #{secondhand_deliveryType_parcel}
			, #{secondhand_deliveryType_zstation}
			, #{secondhand_deliveryType_zman}
			, #{secondhand_paymentType_zpay}
			)
	</insert>
	
	<!-- 중고상품 목록 조회작업 -->
	<!-- 해당카테고리 조회 작업으로 뷰 생성 SECONDHAND_CATEGORY -->
	<select id="selectSecondhandList" resultType="com.itwillbs.zero.vo.SecondhandVO">
		SELECT
			*
		FROM
			SECONDHAND_CATEGORY
		ORDER BY
			secondhand_first_date DESC 
<!-- 		LIMIT -->
<!-- 			#{startRow} -->
<!-- 			,#{listLimit} -->
	</select>
	
	<!-- 중고상품 목록 개수 조회작업(페이징) -->
	<select id="selectSecondhandListCount" resultType="int">
		SELECT 
			COUNT(*)
		FROM 
			SECONDHAND
	</select>
	
	<!-- 중고상품 상세페이지 - 상품상세정보 조회작업 -->	
	<select id="selectProduct" resultType="com.itwillbs.zero.vo.SecondhandVO">
		SELECT *
		FROM
			SECONDHAND_CATEGORY
		WHERE
			secondhand_idx = #{secondhand_idx}
	</select>
	
	
	<!-- 중고상품 상세페이지 - 판매자 정보 조회  -->
	<!-- 필요정보 : 판매자 프로필이미지, 닉네임, 주소, 등 -->
	<!-- 판매중 상품의 개수????? 는 따로-->
	<select id="selectSellerInfo" resultType="hashmap">
		SELECT *
		FROM 
			MEMBER m
		JOIN
			SECONDHAND s
		ON 
			m.member_id = s.member_id
		WHERE
			s.member_id = #{member_id}
			AND secondhand_idx = #{secondhand_idx}
	</select>
	
	
	<!-- 판매자의 판매상품 총 개수 조회 -->
	<select id="selectSellerProductCount" resultType="int">
		SELECT 
			COUNT(*)
		FROM 
			SECONDHAND
		WHERE 
			member_id = #{member_id}
	</select>


	<!-- 판매자의 판매 물품 리스트 조회 -->
	<select id="selectSellerProductList" resultType="hashmap">
		SELECT *
		FROM 
			MEMBER m
		JOIN
			SECONDHAND s
		ON 
			m.member_id = s.member_id
		WHERE
			s.member_id = #{member_id}
	</select>












	<!-- 판매자페이지 - 판매자 정보 조회요청 -->
	<select id="selectSellerInfo_sellerPage" resultType="com.itwillbs.zero.vo.MemberVO">
		SELECT *
		FROM MEMBER
		WHERE 
			member_id = #{member_id}
	</select>


	<!-- 판매자페이지 - 거래중인 판매자의 상품 목록 조회요청 -->
	<select id="selectDealProductList" resultType="hashmap">
		SELECT *
		FROM SECONDHAND
		WHERE 
			member_id = #{member_id}
			AND (secondhand_deal_status = '판매중' OR '예약중')
	</select>
	<!-- 판매자페이지 - 거래완료된 판매자의 상품 목록 조회요청 -->
	<select id="selectSoldoutProductList" resultType="hashmap">
		SELECT *
		FROM SECONDHAND
		WHERE 
			member_id = #{member_id}
			AND (secondhand_deal_status = '판매완료')
	</select>
	
	
	<!-- 판매자페이지 - 거래중인 판매자의 상품 개수 조회요청 -->
	<select id="selectDealProductCount" resultType="int">
		SELECT COUNT(*)
		FROM SECONDHAND
		WHERE 
			member_id = #{member_id}
			AND (secondhand_deal_status = '판매중' OR '예약중')
	</select>
	<!-- 판매자페이지 - 거래완료된 판매자의 상품 개수 조회요청 -->
	<select id="selectSoldOutProductCount" resultType="int">
		SELECT COUNT(*)
		FROM SECONDHAND
		WHERE 
			member_id = #{member_id}
			AND (secondhand_deal_status = '판매완료')
	</select>







	<!-- 글 정보 수정작업 -->
	<!-- 파일은 파일명이 전달되었을경우(널스트링아닐경우)에만 수정 -->
	<!-- 날짜는 변경X? (끌어올리기기능 사용시에만 업데이트?) -->
	<update id="updateSecondhand" >
		UPDATE SECONDHAND
		SET 
			secondhand_price = #{secondhand_pirce}
			, secondhand_content = #{secondhand_content}
			, secondhand_deliveryType_ptp = #{secondhand_deliveryType_ptp}
			, secondhand_paymentTpye_ptp = #{secondhand_paymentTpye_ptp}
				<if test="!file1.equals('')">
					, secondhand_image1 = #{secondhand_image1}
				</if>
				<if test="!file2.equals('')">
					, secondhand_image2 = #{secondhand_image2}
				</if>
				<if test="!file3.equals('')">
					, secondhand_image3 = #{secondhand_image3}
				</if>
							
			, category_idx = #{category_idx}
			, secondhand_deliveryType_parcel = #{secondhand_deliveryType_parcel}
			, secondhand_deliveryType_zstation = #{secondhand_deliveryType_zstation}
			, secondhand_deliveryType_zman = #{secondhand_deliveryType_zman}
			, secondhand_paymentTpye_zpay = #{secondhand_paymentTpye_zpay}
		WHERE
			secondhand_idx = #{secondhand_idx}
	</update>
	
	<!-- 글 삭제작업 -->
	<!-- 전달받은 상품번호와 일치하는 레코드 삭제 -->
	<delete id="deleteSecondhand">
		DELETE
			FROM SECONDHAND
			WHERE
				secondhand_idx = #{secondhand_idx}
	</delete>


	<!-- 글 상세정보 조회 - 조회수 증가 작업 -->
	<update id="updateReadCount">
		UPDATE SECONDHAND
		SET secondhand_readcount = secondhand_readcount + 1
		WHERE 
			secondhand_idx = #{secondhand_idx}
	</update>
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- 검색 - 중고상품리스트 조회 -->
	<select id="selectSearchSecondhandList" resultType="com.itwillbs.zero.vo.SecondhandVO">
		SELECT *
		FROM 
			SECONDHAND
		WHERE
	    	<if test="!productSearchKeyword.equals('')">
        			secondhand_subject LIKE '%${productSearchKeyword}%'
     		</if>
		ORDER BY
			secondhand_first_date
	</select>	
	
	<!-- 검색된 중고상품의 개수 조회 -->
	<select id="selectSearchSecondhandCount" resultType="int">
		SELECT COUNT(*)
		FROM 
			SECONDHAND
		WHERE
	    	<if test="!productSearchKeyword.equals('')">
        			secondhand_subject LIKE '%${productSearchKeyword}%'
     		</if>
	</select>
	



	<!-- 신고하기 insert작업 -->
	<!-- 
	reportType=에따라 report_type insert
	report_content는 그대로 입력
	 -->
<!-- 	<update id="insertReport"> -->
<!-- 	      SET FOREIGN_KEY_CHECKS = 0; -->
	
<!-- 		INSERT INTO -->
<!-- 			REPORT( -->
<!-- 			<if test="reportType.equals('member')"> -->
<!-- 				report_type -->
<!-- 				, report_content -->
<!-- 				, report_status -->
<!-- 				, report_member_id -->
<!-- 				, reported_member_id -->
<!-- 			</if> -->
<!-- 			<if test="reportType.equals('goods')"> -->
<!-- 				report_type -->
<!-- 				, secondhand_idx -->
<!-- 				, report_content -->
<!-- 				, report_status -->
<!-- 				, report_member_id		 -->
<!-- 				</if> -->
<!-- 			) -->
<!-- 		VALUES  -->
<!-- 			(	 -->
<!-- 			<if test="reportType.equals('member')"> -->
<!-- 				report_type = '회원' -->
<!-- 				, report_content = #{reportReason} -->
<!-- 				, report_status = '처리전' -->
<!-- 				, report_member_id = #{report_member_id} -->
<!-- 				, reported_member_id = #{member_id} -->
<!-- 			</if> -->
<!--  			<if test="reportType.equals('zman')"> --> 
<!--  				report_type = 'ZMAN' --> 
<!--  			</if> --> 
<!-- 			<if test="reportType.equals('goods')"> -->
<!-- 				report_type = '상품' -->
<!-- 				, secondhand_idx = #{secondhand_idx} -->
<!-- 				, report_content = #{reportReason} -->
<!-- 				, report_status = '처리전' -->
<!-- 				, report_member_id = #{report_member_id} -->
<!-- 			</if> -->
<!-- 			)		 -->
<!--       SET FOREIGN_KEY_CHECKS = 1; -->
<!-- 	</update> -->
	
	
	
	
	
	<!-- 끌어올리기 작업 시 업데이트 처리 (등록날짜)-->
	
</mapper>
