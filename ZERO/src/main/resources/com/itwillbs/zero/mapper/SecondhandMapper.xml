<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.zero.mapper.SecondhandMapper">

	<!-- 중고 카테고리 조회 작업 -->
	<select id="selectCategoryList" resultType="hashmap">
		SELECT * 
		FROM 
			CATEGORY
		WHERE 
			category_type = '중고'
	</select>
	
		<!-- 상품번호에 해당하는 카테고리 정보 조회작업 --> 
<!-- 	<select id="selectCategory" resultType="String"> -->
<!-- 		SELECT  -->
<!-- 			c.category_name -->
<!-- 		FROM -->
<!-- 			CATEGORY c -->
<!-- 		JOIN -->
<!-- 			SECONDHAND s -->
<!-- 		ON  -->
<!-- 			c.category_idx = s.category_idx -->
<!-- 		WHERE  -->
<!-- 			s.secondhand_idx = #{secondhand_idx} -->
<!-- 	</select> -->
	
	
	<!-- 중고 상품 등록 작업  -->
	<insert id="insertProduct">

		INSERT INTO 
			SECONDHAND	
		VALUES (
			null 								-- secondhand_idx		 	
			, #{secondhand_price}
			, #{secondhand_subject}
			, #{secondhand_content}
			, #{secondhand_deliveryType_ptp}
			, #{secondhand_paymentType_ptp}
			, #{secondhand_image1}
			, #{secondhand_image2}
			, #{secondhand_image3}
			, now()								-- 작성일
			, null 								-- update date
			, 0									-- read count(조회수)
			, secondhand_idx + 1				-- re_ref
			, '판매중'							-- deal_status(default 거래중?)
			, #{member_id}	 					-- 작성자
			, #{category_idx}
			, #{secondhand_deliveryType_parcel}
			, #{secondhand_deliveryType_zstation}
			, #{secondhand_deliveryType_zman}
			, #{secondhand_paymentType_zpay}
			)
	</insert>
	
	<!-- 중고상품 목록 조회작업 -->
	<!-- 해당카테고리 조회 작업으로 뷰 생성 SECONDHAND_CATEGORY -->
	<select id="selectSecondhandList" resultType="com.itwillbs.zero.vo.SecondhandVO">
		SELECT
			*
		FROM
			SECONDHAND_CATEGORY
		ORDER BY
			secondhand_first_date DESC 
<!-- 		LIMIT -->
<!-- 			#{startRow} -->
<!-- 			,#{listLimit} -->
	</select>
	
	<!-- 중고상품 목록 개수 조회작업(페이징) -->
	<select id="selectSecondhandListCount" resultType="int">
		SELECT 
			COUNT(*)
		FROM 
			SECONDHAND
	</select>
	
	<!-- 중고상품 상세페이지 - 상품상세정보 조회작업 -->	
	<select id="selectProduct" resultType="com.itwillbs.zero.vo.SecondhandVO">
		SELECT *
		FROM
			SECONDHAND_CATEGORY
		WHERE
			secondhand_idx = #{secondhand_idx}
	</select>
	
	
	<!-- 중고상품 상세페이지 - 판매자 정보 조회  -->
	<!-- 필요정보 : 판매자 프로필이미지, 닉네임, 주소, 등 -->
	<!-- 판매중 상품의 개수????? 는 따로-->
	<select id="selectSellerInfo" resultType="hashmap">
		SELECT *
		FROM 
			MEMBER m
		JOIN
			SECONDHAND s
		ON 
			m.member_id = s.member_id
		WHERE
			secondhand_idx = #{secondhand_idx}
			AND s.member_id = #{member_id}
			
	</select>
	
	
	<!-- 판매자의 판매상품 총 개수 조회 -->
	<select id="selectSellerProductCount" resultType="int">
		SELECT 
			COUNT(*)
		FROM 
			SECONDHAND
		WHERE 
			member_id = #{member_id}
	</select>


	<!-- 판매자의 판매 물품 리스트 조회 -->
	<select id="selectSellerProductList" resultType="hashmap">
		SELECT *
		FROM 
			MEMBER m
		JOIN
			SECONDHAND s
		ON 
			m.member_id = s.member_id
		WHERE
			s.member_id = #{member_id} 	

	</select>


	
	
	
	<!-- 끌어올리기 작업 시 업데이트 처리 (등록날짜)-->
	
</mapper>
